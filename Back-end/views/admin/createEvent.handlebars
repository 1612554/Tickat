<link rel="stylesheet" href="/css/style3.css">
   <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
      <div class="container">
          <div class="row">
            
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 mb-200">           
              <nav>
                <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                  <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true"><span class="step-create-event">1</span> Event information</a>
                  <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false"><span class="step-create-event">2</span> Add new tickets</a>
                  <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false"><span class="step-create-event">3</span> Confirm</a>
                </div>
              </nav>
              <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                      
                        <div class="card-body">
                            <div class="form-group">
                                <div>
                                    <label for="profile-img" class="btn title" style="cursor: pointer"><i class="far fa-images"></i> Choose image here:</label>
                                    <input name="file" id="profile-img" style="visibility:hidden;" type="file">
                                </div>
                                
                                <img src="https://www.riversports.com/rs/img/system/add_image_placeholder.png" id="profile-img-tag" style="width: 100%; height: 500px;"/>
                            </div>
                            <div class="form-group">
                              <label class="title"><i class="fas fa-edit"></i> Event name:</label>
                              <input type="text"
                                class="form-control" name="" id="name" aria-describedby="helpId" placeholder="">
                            </div>
                          
                            
                            <label  class="title"><i class="fas fa-clock" aria-hidden="true"></i> Datetime</label>
                            <input id="date" width="312px" />

                            <div class="form-group mt-20">
                              <label  class="title"><i class="fas fa-map-marker"></i> Address:</label>
                              <input type="text"
                                class="form-control" name="" id="address" aria-describedby="helpId" placeholder="">
                            </div>

                            <label  class="title"><i class="fas fa-flag"></i> Organization:</label>
                            <div class="input-group">
                                <select class="custom-select" id="organization" aria-label="Example select with button addon" style=" margin-right: 5%">
                                    {{#each organizations}}
                                    <option value="{{id}}">{{name}}</option>
                                    {{/each}}
                                </select>

                                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#addOrganization"> <i class="fas fa-plus-circle"></i> Add an organization</button>
                            </div>

                            <label  class="title mt-20"><i class="fas fa-align-justify"></i> Category:</label>
                            <div class="input-group">
                                <select class="custom-select" id="category" aria-label="Example select with button addon" style=" margin-right: 5%">
                                   {{#each categories}}
                                    <option value="{{id}}">{{name}}</option>
                                    {{/each}}
                                </select>

                                <button type="button" class="btn btn-success" data-toggle="modal" data-target="#addCategory"> <i class="fas fa-plus-circle"></i> Add a category</button>
                            </div>

                            <label  class="title mt-20"><i class="fas fa-info-circle"></i> Description:</label>
                            <textarea name="mailEditor" id="txtEditor"></textarea>

                        </div>
                      <div class="btn-group" role="group" aria-label="Basic example" style="float: right; margin-bottom: 15px;margin-top:30px;margin-right:15px">
                            <button type="button" class="btn btn-secondary" id="btn-next-event">Next <i class="fas fa-chevron-right"></i></button>
                      </div>
                </div>
                <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                    <div class="card-body">
                        <div class="tickets">
                          
                          </div>
                          <div id="editor">
                             <div class="card">
                                 <div class="card-body">
                                     <div class="form-inline" style="margin-bottom: 15px">
                                     <select class="form-control" name="" id="type">
                                       <option value="-1">Type of ticket</option>
                                       {{#each type_of_tickets}}
                                        <option value="{{id}}">{{name}}</option>
                                       {{/each}}
                                     </select>
                                     <button type="button" class="btn btn-success" data-toggle="modal" data-target="#addType" style="float: right"><i class="fas fa-plus"></i> Create new type</button> 
                                   </div>

                                 
                                   <div class="form-inline">
                                     <input type="number" min="0" class="form-control price" id="price" aria-describedby="helpId" placeholder="Price">
                                     <input type="number" min="0" class="form-control amount" id="amount" aria-describedby="helpId" placeholder="Amount">
                                   </div>

                                   <div class="form-group">
                                     <label style="font-weight: 600; margin-left: 5px;margin-top: 7px;">Description:</label>
                                     <textarea class="form-control" id="description" rows="3" placeholder=""></textarea>
                                   </div>
                                 </div>
                             </div>
                          </div>

                          <div style="text-align: center">
                            <button type="button" class="btn btn-primary btn-save" style="margin:40px 10px; display: none">Save</button>
                            <button type="button" class="btn btn-success btn-editor" style="margin:40px 30px"><i class="fa fa-plus"></i> Add new ticket</button>
                          </div>

                          <div class="btn-group" role="group" aria-label="Basic example" style="float: right; margin-bottom: 15px;margin-top:30px">
                            <button type="button" class="btn btn-secondary" id="btn-pre-ticket"><i class="fas fa-chevron-left"></i> Pre</button>
                            <button type="button" class="btn btn-secondary" id="btn-next-ticket">Next <i class="fas fa-chevron-right"></i></button>
                          </div>
                    </div>
                       
                </div>
                <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab" style="text-align: center">
                   <div>

                   <button type="button" class="btn btn-success btn-rounded btn-create"> Press to create</button> 
                   </div>
                </div>

              </div>
            
            </div>
          </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addCategory" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New category</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Name:</label>
            <input type="text" class="form-control" id="category_name" placeholder="sport">
          </div>
          <div class="form-group">
            <label for="message-text" class="col-form-label">URL image:</label>
            <textarea class="form-control" id="category_img" placeholder="https://amazonaws.com/image.jpg"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="saveCategory">Save this category</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade bd-example-modal-lg" id="addOrganization" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
     <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New organization</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
                    <form id="saveOrganization">
                      <label>Organization name</label>
                    <input type="text" class="form-control" id="organization_name" required>
                    <br>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label>Phone</label>
                        <input type="text" class="form-control" id="organization_tel" placeholder="084 624 2658" required>
                      </div>
                      <div class="form-group col-md-6">
                        <label>Email</label>
                        <input type="email" class="form-control" id="organization_mail" placeholder="example@gmail.com" required>
                      </div>
                    </div>
                    
                    <label>Address</label>
                    <input type="text" class="form-control" id="organization_address" required>
                    <br>
                    <div class="form-row">
                      <div class="form-group col-md-6">
                        <label>Website</label>
                        <input type="text" class="form-control" id="organization_website" placeholder="https://www.abc.com">
                      </div>
                      <div class="form-group col-md-6">
                        <label>Image link</label>
                        <input type="text" class="form-control" id="organization_img" placeholder="https://www.abc.com/image.img">
                      </div>
                    </div>
                    <br>
                    <div class="form-row">
                          <label for="">Description</label>
                          <textarea class="form-control" id="organization_description" rows="3"></textarea>
                    </div>
                    </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary" id="saveCategory" form="saveOrganization">Save this organization</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="addType" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">New type of ticket</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="recipient-name" class="col-form-label">Name:</label>
            <input type="text" class="form-control" id="type_name" placeholder="Normal">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="saveType">Save</button>
      </div>
    </div>
  </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/bs4-summernote@0.8.10/dist/summernote-bs4.min.js"></script>

    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<script>
  $('#date').datetimepicker({  
    footer: true, 
    modal: true ,
    format: 'yyyy-mm-dd HH:MM:ss',
    use24hours: true
  });

$(document).ready(function() {
    $('#txtEditor').summernote({
        height: 300,   //set editable area's height
    });
});

function readURL(input) {
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        
        reader.onload = function (e) {
            $('#profile-img-tag').attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
    }
}
$("#profile-img").change(function(){
    readURL(this);
});

  $("#profile-img-tag").click(()=>{
    $("#profile-img").click();
});


</script>


<script>
    $('.btn-editor').click(()=>{
    if($("#editor").is(":visible")){
      $("#editor").hide();
      $(".btn-save").hide();
      $('.btn-editor').html("Add new ticket");
    }else{
      $("#editor").show();
      $(".btn-save").show();
      $('.btn-editor').html("Close");
    }
  });

  $(document).ready(function() {
     $('.btn-editor').click();
});

  $(".btn-save").click(()=>{
      var type_id = $("#type option:selected").val();
      var type = $("#type option:selected").text();
      var price = parseInt($("#price").val()) || 0;
      var description = $("#description").val();
      var amount = $("#amount").val();

      if(type_id==-1){
        alert("Please choose type of ticket!");
      }else if(typeof price == 'undefined'){
        alert("Price is required!");
      }else if(description==""){
        alert("Description is required!");
      }else if(typeof amount == 'undefined'|| amount<0){
        alert("Amount is required!");
      }else{
        var obj = JSON.stringify({type_id:type_id,price:price,amount:amount,description:description});

        $(".tickets").append(
          `
          <div class="card" data-ticket='${obj}'>
              <div class="card-body">
                  <span class="card-title">${type}</span>
                  <span class="card-subtitle mb-2 text-muted">Price: ${price}</span>
                  <p class="card-text">Description: ${description}</p>
                  <p>Amount: ${amount}</p>
                  <button type="button" class="btn btn-danger delete">Delete</button>
              </div>
          </div>
          `
        );

        $(".delete").on('click', function() {
          $(this).parent().parent().remove();
        });

        resetForm();
        $('.btn-editor').click();
      }
      
  });

  function resetForm(){
    $("#type").val(-1);
    $("#price").val("");
    $("#amount").val("");
    $("#description").val("");
  }

  $(".btn-create").click(()=>{
    var tickets = [];
    $(".tickets .card").each(function (index, element) {
        var ticket = $(this).data("ticket");
        tickets.push(JSON.stringify(ticket));
    });
    
    
    var name = $("#name").val();
    var date = $("#date").val();
    var address = $("#address").val();
    var description =  $("#txtEditor").val();
    var organization_id = $("#organization option:selected").val();
    var category_id = $("#category option:selected").val();
    var img = $("#profile-img").prop('files')[0];

    if(name==""||typeof name == 'undefined'){
      alert("Event name is required !"); return ;
    }
    if(date==""||typeof date == 'undefined'){
      alert("Date is required !"); return ;
    }
    if(address==""||typeof address == 'undefined'){
      alert("Address is required !"); return ;
    }
    if(typeof organization_id == 'undefined'){
      alert("Organization is required !"); return ;
    }
    if(typeof img == 'undefined'){
      alert("Image is required !"); return ;
    }
      
    var formData = new FormData();

    formData.append("name",name);
    formData.append("date",date);
    formData.append("address", address);
    formData.append("description", description);
    formData.append("organization_id", organization_id);
    formData.append("category_id",category_id);
    formData.append("tickets", JSON.stringify(tickets));
    formData.append("img",$("#profile-img").prop('files')[0]);

    $.ajax({
          type: "POST",
          url: "/admin/events",
          data: formData,
          processData: false,
          contentType: false,
          success: function (res) {
             if(res.status==200){
              showSnackbar(res.message);
              setTimeout(function () {
                  location.href = "/admin/events";
              }, 1000);
            }
            else alert(res.message);
          }
      });
  });
</script>

<script>
  $("#saveCategory").click(()=>{
    var category_name = $("#category_name").val();
    var category_img = $("#category_img").val();

    if(category_img == ""|| category_name==""){
      alert("Name and image are required !"); 
      return;
    }

    $.ajax({
      type: "POST",
      url: "/admin/categories",
      data: {
        name: category_name,
        img: category_img
      },
      success: function (res) {
          if(res.status==200 && res.html !=""){
              showSnackbar(res.message);
              $("#category").append(res.html);
          }
          else alert(res.message);
      }
    });

    $('#addCategory').modal('toggle');
  });

</script>

<script>
  $( "#saveOrganization" ).submit(function( event ) {
    event.preventDefault();
  
    var organization_name = $("#organization_name").val();
    var organization_tel = $("#organization_tel").val();
    var organization_mail = $("#organization_mail").val();
    var organization_address = $("#organization_address").val();
    var organization_web = $("#organization_website").val();
    var organization_img = $("#organization_img").val();
    var organization_description = $("#organization_description").val();

    $.ajax({
      type: "POST",
      url: "/admin/organizations",
      data: {
        name: organization_name,
        img: organization_img,
        tel: organization_tel,
        mail: organization_mail,
        address:  organization_address,
        website: organization_web,
        description: organization_description
      },
      success: function (res) {
          if(res.status==200 && res.html !=""){
              showSnackbar(res.message);
              $("#organization").append(res.html);
          }
          else alert(res.message);
      }
    });

    $('#addOrganization').modal('toggle');
});
</script>

<script>
  $("#saveType").click(()=>{
    var type_name = $("#type_name").val();

    if(type_name==""){
      alert("Name is required !"); 
      return;
    }

    $.ajax({
      type: "POST",
      url: "/admin/type-of-tickets",
      data: {
        name: type_name
      },
      success: function (res) {
          if(res.status==200 && res.html !=""){
              showSnackbar(res.message);
              $("#type").append(res.html);
          }
          else alert(res.message);
      }
    });

    $('#addType').modal('toggle');
  });

</script>

<script>
  $("#btn-next-event").click(()=>{$("#nav-profile-tab").click();});

  $("#btn-pre-ticket").click(()=>{$("#nav-home-tab").click();});
  $("#btn-next-ticket").click(()=>{$("#nav-contact-tab").click();});

</script>